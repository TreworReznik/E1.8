<!DOCTYPE html>
<html lang="ru">
<head>
    <title>Внешние скрипты, порядок исполнения</title>
    <meta charset="utf-8"/>
    <link rel="stylesheet" href="style.css"/>

</head>
<body>
<header class="header ">
    <a href="index.html"><h1>JS </h1></a>
    <nav>
        <ul class="menu">
            <a href="index.html">
                <li>Главная</li>
            </a>
            <a href="contacts.html">
                <li>Контакты</li>
            </a>
            <a href="about.html">
                <li>Обо мне</li>
            </a>
        </ul>
    </nav>
</header>
<div class="content ">
    <div class="content-text" align="left">
        <h2 align="center">Скрипты: <q>async</q>, <q>defer</q></h2>
        <p>В современных сайтах скрипты обычно<strong> тяжелее</strong>, чем HTML: они весят больше, дольше
            обрабатываются.</p>
        <p>Когда браузер загружает HTML и доходит до тега <code>&lt;script&gt;...&lt;/script&gt;</code>, он не может
            продолжать строить DOM. Он должен сначала выполнить скрипт. То же самое происходит и с внешними скриптами
            <code>&lt;script src="..."&gt;&lt;/script&gt;</code>: браузер должен подождать, пока загрузится скрипт,
            выполнить его, и только затем обработать остальную страницу.</p>
        <p align="center">Это ведёт к двум важным проблемам:</p>
        <ol>
            <li>Скрипты не видят DOM-элементы ниже себя, поэтому к ним нельзя добавить обработчики и т.д.</li>
            <li>Если вверху страницы объёмный скрипт, он «блокирует» страницу. <p>Пользователи не видят содержимое
                страницы, пока он не загрузится и не запустится.

            </li>
        </ol>
        <img src="image/2023-10-07_17-56-34.png" alt="что то там">
        <p>Конечно, есть пути, как это обойти. Например, мы можем поместить скрипт внизу страницы.</p>
        <p>Тогда он сможет видеть элементы над ним и не будет препятствовать отображению содержимого страницы:</p>
        <img src="image/2023-10-07_18-04-17.png" alt="что то там">
        <p>Но это решение далеко от идеального. Например, браузер замечает скрипт (и может начать загружать его) только
            после того, как он полностью загрузил HTML-документ. В случае с длинными HTML-страницами это может создать
            заметную задержку.</p>
        <p>Такие вещи незаметны людям, у кого очень быстрое соединение, но много кто в мире имеет медленное подключение
            к интернету или использует не такой хороший мобильный интернет.</p>
        <p>К счастью, есть два атрибута тега <code>&lt;script&gt;</code>, которые решают нашу проблему:
            <code>defer</code> и <code>async</code>.</p>
        <h2 align="center">defer</h2>
        <p>Атрибут <code>defer</code> сообщает браузеру, что он должен продолжать обрабатывать страницу и загружать
            скрипт в фоновом режиме, а затем запустить этот скрипт, когда DOM дерево будет полностью построено.</p>
        <p>Вот тот же пример, что и выше, но с <code>defer</code>:</p>
        <img src="image/2023-10-09_14-08-00.png" alt="что то там">
        <ul>
            <li>Скрипты с <code>defer</code> никогда не блокируют страницу.</li>
            <li>Скрипты с <code>defer</code> всегда выполняются, когда дерево DOM готово, но до события <code>DOMContentLoaded</code>.
            </li>
        </ul>
        <p>Следующий пример это показывает:</p>
        <img src="image/2023-10-09_15-29-00.png" alt="что то там">
        <ol>
            <li>Содержимое страницы отобразится мгновенно.</li>
            <li>Событие <code>DOMContentLoaded</code> подождёт отложенный скрипт. Оно будет сгенерировано, только когда
                скрипт <code>(2)</code> будет загружен и выполнен.
            </li>
        </ol>
        <p><strong>Отложенные с помощью <code>defer</code> скрипты сохраняют порядок относительно друг друга, как и
            обычные скрипты.</strong></p>
        <p>Допустим, у нас есть два скрипта c <code>defer</code>: <code>small.js</code> и <code>long.js</code>:</p>
        <img src="image/2023-10-09_15-30-30.png" alt="что то там">
        <p>Браузеры сканируют страницу на предмет скриптов и загружают их параллельно в целях увеличения
            производительности. Поэтому и в примере выше оба скрипта скачиваются параллельно. <code>small.js</code>
            скорее всего загрузится первым.</p>
        <p>…Но <code>defer</code> не только говорит браузеру «не блокировать рендеринг», он также обеспечивает
            правильную последовательность выполнения скриптов. Даже если <code>small.js</code> загрузится первым, он
            будет ждать выполнения <code>long.js</code>.</p>
        <p>Это важно в тех случаях, когда нам сначала нужно загрузить JavaScript-библиотеку, а затем скрипт, который от
            неё зависит.</p>
        <p>Атрибут <code>defer</code> будет проигнорирован, если в теге <code>&lt;script&gt;</code> нет <code>src</code>.
        </p>
        <h2 align="center">async</h2>
        <p>Атрибут <code>async</code> означает, что скрипт абсолютно независим:</p>
        <ul>
            <li>Страница не ждёт асинхронных скриптов, содержимое обрабатывается и отображается.</li>
            <li>Событие <code>DOMContentLoaded</code> и асинхронные скрипты не ждут друг друга:
                <ul>
                    <li><code>DOMContentLoaded</code> может произойти как до асинхронного скрипта (если асинхронный
                        скрипт завершит загрузку после того, как страница будет готова),
                    </li>
                    <li>…так и после асинхронного скрипта (если он короткий или уже содержится в HTTP-кеше)</li>
                </ul>
            </li>
            <li>Остальные скрипты не ждут <code>async</code>, и скрипты c<code>async</code> не ждут другие скрипты.</li>
        </ul>
        <p>Так что если у нас есть несколько скриптов с <code>async</code>, они могут выполняться в любом порядке. То,
            что первое загрузится – запустится в первую очередь:</p>
        <img src="image/2023-10-09_15-04-48.png" alt="что то там">
        <ol>
            <li>Содержимое страницы отображается сразу же : <code>async</code> его не блокирует.</li>
            <li><code>DOMContentLoaded</code> может произойти как до, так и после <code>async</code>, никаких гарантий
                нет.
            </li>
            <li>Асинхронные скрипты не ждут друг друга. Меньший скрипт <code>small.js</code> идёт вторым, но скорее
                всего загрузится раньше <code>long.js</code>, поэтому и запустится первым. То есть, скрипты выполняются
                в порядке загрузки.
            </li>
        </ol>
        <p>Асинхронные скрипты очень полезны для добавления на страницу сторонних скриптов: счётчиков, рекламы и т.д.
            Они не зависят от наших скриптов, и мы тоже не должны ждать их:</p>
        
        <img src="image/2023-10-09_15-02-23.png" alt="что то там">
        <img src="image/2023-10-09_15-03-19.png" alt="что то там">

        <h2 >Динамически загружаемые скрипты</h2>
        <p>Мы можем также добавить скрипт и динамически, с помощью JavaScript:</p>
        <img src="image/2023-10-09_15-00-07.png" alt="что то там">
        <p>Скрипт начнёт загружаться, как только он будет добавлен в документ <code>(*)</code>.</p>
        <p align="center"><strong>Динамически загружаемые скрипты по умолчанию ведут себя как «async».</strong></p>
        <p>То есть:</p>
        <ul>
            <li>Они никого не ждут, и их никто не ждёт.</li>
            <li>Скрипт, который загружается первым – запускается первым (в порядке загрузки).</li>

            <p>Мы можем изменить относительный порядок скриптов с «первый загрузился – первый выполнился» на порядок, в
                котором они идут в документе (как в обычных скриптах) с помощью явной установки свойства
                <code>async</code> в <code>false</code>:</p>
        </ul>
        <img src="image/2023-10-09_14-59-11.png" alt="что то там">
        <p>Например, здесь мы добавляем два скрипта. Без <code>script.async=false</code> они запускались бы в порядке
            загрузки (<code>small.js</code> скорее всего запустился бы раньше). Но с этим флагом порядок будет как в
            документе:</p>
        <img src="image/2023-10-09_14-58-06.png" alt="что то там">
        <h2>Итого</h2>
        <p>У <code>async</code> и <code>defer</code> есть кое-что общее: они не блокируют отрисовку страницы. Так что
            пользователь может просмотреть содержимое страницы и ознакомиться с ней сразу же.</p>
        <p>Но есть и значимые различия:</p>
        <table>
            <thead>
            <tr>
                <th></th>
                <th>Порядок</th>
                <th><code>DOMContentLoaded</code></th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td><code>async</code></td>
                <td><em>Порядок загрузки</em> (кто загрузится первым, тот и сработает).</td>
                <td>Не имеет значения. Может загрузиться и выполниться до того, как страница полностью загрузится. Такое случается, если скрипты маленькие или хранятся в кеше, а документ достаточно большой.</td>
            </tr>
            <tr class="table-tr-color">
                <td><code>defer</code></td>
                <td><em>Порядок документа</em> (как расположены в документе).</td>
                <td>Выполняется после того, как документ загружен и обработан  (ждёт), непосредственно перед <code>DOMContentLoaded</code>.</td>
            </tr>
            </tbody>
        </table>
        <img src="image/2023-10-09_14-55-46.png" alt="что то там">
        <p>На практике <code>defer</code> используется для скриптов, которым требуется доступ ко всему DOM и/или важен их относительный порядок выполнения.</p>
        <p>А <code>async</code> хорош для независимых скриптов, например счётчиков и рекламы, относительный порядок выполнения которых не играет роли.</p>
    </div>
</div>
</body>
<footer>
    <li>©&nbsp;2007—2023&nbsp; Илья</li>
</footer>
</html>
